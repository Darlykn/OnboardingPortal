# Onboarding Portal

Внутренний портал адаптации для ГМИС (группа сопровождения информационных систем) в банке.

## Стек технологий

### Frontend
- **React** - UI-фреймворк
- **Vite** - сборщик
- **Tailwind CSS** - CSS-фреймворк
- **Zustand** - state management
- **React Router DOM** - роутинг
- **TanStack React Query** - управление серверным состоянием
- **Heroicons** - иконки

### Backend
- **Node.js** - рантайм
- **Express** - веб-фреймворк
- **better-sqlite3** - SQLite драйвер

## Установка и запуск

### Первоначальная настройка

```bash
# Установка зависимостей
npm install
cd client && npm install
cd ../server && npm install
cd ..

# Настройка переменных окружения (опционально)
# Скопируйте .env.example в .env и настройте при необходимости
cp .env.example .env
```

### Инициализация базы данных

База данных создается автоматически при первом запуске сервера. Seed-данные загружаются автоматически, если БД пустая.

```bash
# База данных создается в server/db/onboarding.db
# Для пересоздания БД удалите файл onboarding.db и перезапустите сервер
```

### Запуск приложения

```bash
# Запуск в режиме разработки (frontend + backend одновременно)
npm run dev

# Или запуск раздельно:
npm run dev:client    # только frontend
npm run dev:server    # только backend
```

Frontend: http://localhost:5173  
Backend API: http://localhost:3001

## Структура проекта

```
OnboardingPortal/
├── client/                      # React frontend
│   ├── src/
│   │   ├── api/                 # API-клиент (client.js)
│   │   ├── components/          # UI-компоненты (Layout, Modal, StyledSelect, MentorSelect)
│   │   ├── pages/               # Страницы
│   │   │   ├── admin/           # Админ-панель (AdminLayout, Users, Tasks, Contacts)
│   │   │   ├── SetupPage.jsx    # Страница входа (логин/пароль)
│   │   │   ├── DashboardPage.jsx
│   │   │   ├── ChecklistPage.jsx
│   │   │   ├── HelpPage.jsx     # Справочник контактов
│   │   │   └── ProcessPage.jsx  # Карта процессов
│   │   └── stores/              # Zustand (userStore, checklistStore)
│   ├── public/
│   └── index.html
├── server/
│   ├── db/                      # database.js, seed.js
│   ├── lib/                     # password.js (хеширование паролей)
│   ├── middleware/              # auth.js (requireUser, requireAdmin)
│   ├── routes/                  # users, tasks, progress, contacts
│   └── index.js
├── package.json
└── .env.example
```

## Авторизация

- **Вход**: на странице `/setup` пользователь вводит логин (формат `U00000000` — латинская U и 8 цифр) и пароль.
- **Создание пользователей**: только администратор создает учетные записи в разделе «Админ» → «Пользователи». Админ задает логин, пароль, имя, этап, роль и ментора.
- **Роли**: `user` (обычный сотрудник), `admin` (доступ к админ-панели).
- Защищенные API-запросы отправляются с заголовком `X-User-Id` (ID текущего пользователя из клиента).

## Функционал

### Для пользователя (роль user)

1. **Главная** — обзор прогресса по этапам, быстрые ссылки на чек-лист и обучение, контакт ментора.
2. **Чек-лист** — задачи по этапам (Этап 1 — Начало, Этап 2 — Теория, Этап 3 — Практика) и категориям (Доступы, Безопасность, Процессы, Обучение, Системы, Применение). Приоритеты: must / should / nice. Сохранение прогресса.
3. **Помощь** — справочник контактов по направлениям (доступы, обучение, мониторинг, эквайринг, процессы, HR). Шаблоны сообщений для копирования, ссылки на Telegram/Email. Отметка контакта наставника.
4. **Карта процессов** — жизненный цикл и артефакты этапов.

### Админ-панель (роль admin)

- **Пользователи** — список, создание (логин, пароль, имя, этап, роль, ментор), редактирование, смена пароля, удаление.
- **Задачи** — CRUD задач чек-листа (название, описание, категория, приоритет, этап, оценка времени, привязка к ментору-контакту).
- **Контакты** — CRUD контактов справочника (имя, роль, зона ответственности, направление, часы, Telegram, Email).

## API Endpoints

| Метод | Endpoint | Описание | Авторизация |
|-------|----------|----------|-------------|
| POST | `/api/users/enter` | Вход (логин + пароль) | — |
| GET | `/api/users` | Список пользователей | admin |
| POST | `/api/users` | Создание пользователя | admin |
| GET | `/api/users/:id` | Получение пользователя | — |
| PATCH | `/api/users/:id` | Обновление пользователя (имя, этап, роль, пароль, ментор) | user (свой профиль) / admin |
| DELETE | `/api/users/:id` | Удаление пользователя | admin |
| GET | `/api/tasks` | Список задач (опционально: stage, category) | — |
| GET | `/api/tasks/:id` | Задача по ID | — |
| POST | `/api/tasks` | Создание задачи | admin |
| PATCH | `/api/tasks/:id` | Обновление задачи | admin |
| DELETE | `/api/tasks/:id` | Удаление задачи | admin |
| GET | `/api/progress/:userId` | Прогресс пользователя по задачам | — |
| GET | `/api/progress/:userId/stats` | Статистика прогресса (по этапам/категориям) | — |
| POST | `/api/progress` | Отметка задачи (user_id, task_id, completed) | — |
| GET | `/api/contacts` | Список контактов (опционально: area) | — |
| POST | `/api/contacts` | Создание контакта | admin |
| PATCH | `/api/contacts/:id` | Обновление контакта | admin |
| DELETE | `/api/contacts/:id` | Удаление контакта | admin |
| GET | `/api/health` | Проверка работы API | — |

Авторизация: заголовок `X-User-Id` с ID пользователя. Для маршрутов с пометкой admin дополнительно проверяется роль `admin`.
